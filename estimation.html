
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Estimation &#8212; ActivitySim 0.1.dev1+gd048ead documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How the System Works" href="howitworks.html" />
    <link rel="prev" title="Command Line Interface" href="cli.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">ActivitySim</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="users-guide/index.html">
  Users Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="dev-guide/index.html">
  Developers
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="gettingstarted.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="users-guide/cli-tools.html">
   Command Line Tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   Command Line Interface
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="howitworks.html">
   How the System Works
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#workflow">
   Workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#settings">
   Settings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimation-notebooks">
   Estimation Notebooks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-api">
   General API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#models-api">
   Models API
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="estimation">
<span id="id1"></span><h1>Estimation<a class="headerlink" href="#estimation" title="Permalink to this headline">#</a></h1>
<p>ActivitySim includes the ability to re-estimate submodels using choice model estimation tools
such as <a class="reference external" href="https://larch.newman.me/">larch</a>.  To do so, ActivitySim adopts the concept of an estimation
data bundle (EDB), which is a collection of the necessary data to re-estimate a submodel.  For example, for the auto ownership submodel,
the EDB consists of the following files:</p>
<ul class="simple">
<li><p>model settings - the auto_ownership_model_settings.yaml file</p></li>
<li><p>coefficients - the auto_ownership_coefficients.csv file with each coefficient name, value, and constrain set to True or False if the coefficient is estimatable</p></li>
<li><p>utilities specification - the auto_ownership_SPEC.csv utility expressions file</p></li>
<li><p>chooser and alternatives data - the auto_ownership_values_combined.csv file with all chooser and alternatives data such as household information, land use information, and the utility data components for each alternative</p></li>
</ul>
<p>ActivitySim also includes Jupyter <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> for estimating submodels with larch, as well as an <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> submodule that transforms EDBs into larch models.  Additional estimation software translators can be added later if desired.</p>
<p>The combination of writing an EDB for a submodel + a larch estimation notebook means users can easily re-estimate submodels. This
combination of functionality means:</p>
<ul class="simple">
<li><p>There is no duplication of model specifications. ActivitySim owns the specification and larch pivots off of it.  Users code model specifications and utility expressions in ActivitySim so as to facilitate ease of use and eliminate inconsistencies and errors between the code used to estimate the models and the code used to apply the models.</p></li>
<li><p>The EDB includes all the data and model structure information and the <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> submodule used by the example notebooks transforms the EDB to larchâ€™s data model for estimation.</p></li>
<li><p>Users are able to add zones, alternatives, new chooser data, new taz data, new modes, new coefficients, revise utilities, and revise nesting structures in ActivitySim and larch responds accordingly.</p></li>
<li><p>Eventually it may be desirable for ActivitySim to automatically write larch estimators (or other types of estimators), but for now the integration is loosely coupled rather than tightly coupled in order to provide flexibility.</p></li>
</ul>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">#</a></h2>
<p>The general workflow for estimating models is shown in the following figures and explained in more detail below.</p>
<img alt="_images/estimation_tools.jpg" src="_images/estimation_tools.jpg" />
<ul class="simple">
<li><p>The user converts their household travel survey into ActivitySim format households, persons, tours, joint tour participants, and trip tables.  The households and persons tables must have the same fields as the synthetic population input tables since the surveyed households and persons will be run through the same set of submodels as the simulated households and persons.</p></li>
<li><p>The ActivitySim estimation example <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> module reads the ActivitySim format household travel survey files and checks for inconsistencies in the input tables versus the model design + calculates additional fields such as the household joint tour frequency based on the trips and joint tour participants table.  Survey households and persons observed choices much match the model design (i.e. a person cannot have more work tours than the model allows).</p></li>
<li><p>ActivitySim is then run in estimation mode to read the ActivitySim format household travel survey files, run the ActivitySim submodels to write estimation data bundles (EDB) that contains the model utility specifications, coefficients, chooser data, and alternatives data for each submodel.  Estimation mode runs single-processed and without destination sampling.</p></li>
<li><p>The relevant EDBs are read and transformed into the format required by the model estimation tool (i.e. larch) and then the coefficients are re-estimated. The <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> library is included for integration with larch and there is a Jupyter Notebook estimation example for each core submodel.  No changes to the model specification are made in the process.</p></li>
<li><p>The user can then update the ActivitySim model coefficients file(s) for the estimated submodel and re-run the model in simulation mode.  The user may want to use the restartable pipeline feature of ActivitySim to just run the submodel of interest.</p></li>
</ul>
<img alt="_images/estimation_example.jpg" src="_images/estimation_example.jpg" />
</section>
<section id="example">
<span id="estimation-example"></span><h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The estimation_mode.ipynb Jupyter <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> also introduces estimation mode and walks the user through the process.</p>
</div>
<p>To run the estimation example, do the following:</p>
<ul class="simple">
<li><p>Activate the correct conda environment if needed</p></li>
<li><p>Create a local copy of the estimation example folder</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">create</span> <span class="o">-</span><span class="n">e</span> <span class="n">example_estimation_sf</span> <span class="o">-</span><span class="n">d</span> <span class="n">test_example_estimation_sf</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Run the example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">test_example_estimation_sf</span>
<span class="n">activitysim</span> <span class="n">run</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs_estimation</span><span class="o">/</span><span class="n">configs</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs</span> <span class="o">-</span><span class="n">o</span> <span class="n">output</span> <span class="o">-</span><span class="n">d</span> <span class="n">data_sf</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ActivitySim should log some information and write outputs to the output folder, including EDBs for each submodel.  The estimation example runs for about 15 minutes and writes EDBs for 2000 households.</p></li>
<li><p>Open <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> for a specific submodel and then step through the notebook to re-estimate the sub-model.</p></li>
</ul>
<p>The estimation example assumes the machine has sufficient RAM to run with chunking disabled (<cite>chunk_training_mode: disabled</cite>).  See <a class="reference internal" href="core.html#chunk-size"><span class="std std-ref">Chunk</span></a> for more information.</p>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">#</a></h2>
<p>Additional settings for running ActivitySim in estimation mode are specified in the <code class="docutils literal notranslate"><span class="pre">estimation.yaml</span></code> file.  The settings are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code> - enable estimation, either True or False</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bundles</span></code> - the list of submodels for which to write EDBs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">survey_tables</span></code> - the list of input ActivitySim format survey tables with observed choices to override model simulation choices in order to write EDBs.  These tables are the output of the <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> script that pre-processes the ActivitySim format household travel survey files for the example data and submodels</p></li>
</ul>
</section>
<section id="estimation-notebooks">
<span id="estimation-example-notebooks"></span><h2>Estimation Notebooks<a class="headerlink" href="#estimation-notebooks" title="Permalink to this headline">#</a></h2>
<p>ActivitySim includes a <a class="reference external" href="https://jupyter.org">Jupyter Notebook</a> recipe book with interactive re-estimation examples for each estimatable submodel.  To run a Jupyter notebook, do the following:</p>
<ul class="simple">
<li><p>Open a conda prompt and activate the conda environment with ActivitySim installed</p></li>
<li><p>If needed, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">jupyterlab</span></code> so you can run jupyter notebooks</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> to launch the web-based notebook manager</p></li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">examples/examples_estimaton/notebooks</span></code> folder and select a notebook from the table below</p></li>
<li><p>Save the updated coefficient file(s) to the configs folder and run the model in simulation mode</p></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>Notebook</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Estimation mode overview</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/01_estimation_mode.ipynb">01_estimation_mode.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>School location</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/02_school_location.ipynb">02_school_location.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Work location</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/03_work_location.ipynb">03_work_location.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Auto ownership</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/04_auto_ownership.ipynb">04_auto_ownership.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Free parking</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/05_free_parking.ipynb">05_free_parking.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>CDAP</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/06_cdap.ipynb">06_cdap.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Mandatory tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/07_mand_tour_freq.ipynb">07_mand_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Work tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/08_work_tour_scheduling.ipynb">08_work_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>School tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/09_school_tour_scheduling.ipynb">09_school_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Joint tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/10_joint_tour_freq.ipynb">10_joint_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Jointatory tour composition</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/11_joint_tour_composition.ipynb">11_joint_tour_composition.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Jointatory tour participation</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/12_joint_tour_participation.ipynb">12_joint_tour_participation.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Joint nonmandatory tour destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/13_joint_nonmand_tour_dest.ipynb">13_joint_nonmand_tour_dest.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Joint tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/14_joint_tour_scheduling.ipynb">14_joint_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Non mandatory tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/15_non_mand_tour_freq.ipynb">15_non_mand_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Non mandatory tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/16_nonmand_tour_scheduling.ipynb">16_nonmand_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Tour mode choice</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/17_tour_mode_choice.ipynb">17_tour_mode_choice.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Atwork subtour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/18_atwork_subtour_freq.ipynb">18_atwork_subtour_freq.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Atwork subtour destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/19_atwork_subtour_dest.ipynb">19_atwork_subtour_dest.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Atwork subtour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/20_atwork_subtour_scheduling.ipynb">20_atwork_subtour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Stop frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/21_stop_frequency.ipynb">21_stop_frequency.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Trip destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/22_trip_dest.ipynb">22_trip_dest.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Trip mode choice</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/master/activitysim/examples/example_estimation/notebooks/23_trip_mode_choice.ipynb">23_trip_mode_choice.ipynb</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="general-api">
<h2>General API<a class="headerlink" href="#general-api" title="Permalink to this headline">#</a></h2>
</section>
<section id="models-api">
<h2>Models API<a class="headerlink" href="#models-api" title="Permalink to this headline">#</a></h2>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="cli.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Command Line Interface</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="howitworks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How the System Works</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright contributing authors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>